import{r as m,j as e}from"./app-DcA4OvQM.js";import{U as j}from"./UserLayout-CvYy6IBB.js";import{g as F}from"./gemini-BOoYf4TD.js";import"./user-BPb7GXe4.js";const K=[{id:"general",name:"General Health",icon:"üè•",color:"blue"},{id:"sexual-health",name:"Sexual Health",icon:"üíä",color:"purple"},{id:"reproductive-health",name:"Reproductive Health",icon:"üå∏",color:"pink"},{id:"contraception",name:"Contraception",icon:"üíâ",color:"green"},{id:"relationships",name:"Relationships",icon:"üíë",color:"red"},{id:"mental-health",name:"Mental Health",icon:"üß†",color:"indigo"},{id:"stis",name:"STIs",icon:"ü¶†",color:"orange"},{id:"family-planning",name:"Family Planning",icon:"üë®‚Äçüë©‚Äçüëß‚Äçüë¶",color:"teal"},{id:"education",name:"Education",icon:"üìö",color:"yellow"}];function X({user:b}){const[h,z]=m.useState(null),[u,Q]=m.useState([]),[g,y]=m.useState({}),[d,p]=m.useState(0),[S,P]=m.useState(!1),[$,v]=m.useState(null),[E,R]=m.useState(!1),[l,N]=m.useState(null),[k,w]=m.useState(null),[_,A]=m.useState(0);m.useEffect(()=>{let s=null;return k&&!l&&(s=setInterval(()=>{A(Math.floor((Date.now()-k)/1e3))},1e3)),()=>{s&&clearInterval(s)}},[k,l]);const T=s=>{const r=Math.floor(s/60),o=s%60;return`${r}:${o.toString().padStart(2,"0")}`},q=async s=>{var r,o,n;z(s),P(!0),v(null),Q([]),y({}),p(0),N(null),w(null),A(0);try{const t=await F(s.name,"",10);Q(t),w(Date.now())}catch(t){console.error("Error generating quiz:",t);const x=t.isRateLimit||((r=t.message)==null?void 0:r.includes("429"))||((o=t.message)==null?void 0:o.includes("Resource exhausted"))||((n=t.message)==null?void 0:n.includes("high demand"));v(x?"The AI service is currently experiencing high demand. Please wait a moment and try again. If the issue persists, please try again in a few minutes.":t.message||"Failed to generate quiz questions. Please try again.")}finally{P(!1)}},L=(s,r,o)=>{y(n=>{if(o){const t=n[s]||[],x=t.includes(r)?t.filter(a=>a!==r):[...t,r];return{...n,[s]:x}}else return{...n,[s]:r}})},D=()=>{d<u.length-1&&p(d+1)},G=()=>{d>0&&p(d-1)},H=()=>{R(!0);let s=0,r=0,o=0;const n=u.map(a=>{const c=g[a.id],Y=Array.isArray(a.correct_answers)?Array.isArray(c)&&c.length===a.correct_answers.length&&c.every(U=>a.correct_answers.includes(U)):c===a.correct_answer;return Y&&(s++,o+=a.points||10),r+=a.points||10,{question:a.question,userAnswer:c,correctAnswer:a.correct_answer||a.correct_answers,isCorrect:Y,explanation:a.explanation}}),t=Math.round(s/u.length*100),x=t>=70;setTimeout(()=>{N({score:t,correctCount:s,totalQuestions:u.length,earnedPoints:o,totalPoints:r,passed:x,results:n,timeElapsed:T(_)}),R(!1)},500)},B=()=>{N(null),y({}),p(0),w(Date.now()),A(0)},C=()=>{z(null),Q([]),y({}),p(0),N(null),w(null),A(0),v(null)},i=u[d],f=u.length,I=Object.keys(g).filter(s=>{const r=g[s];return Array.isArray(r)?r.length>0:r!=null&&r!==""}).length,M=()=>{if(!i)return!1;const s=g[i.id];return Array.isArray(s)?s.length>0:s!=null&&s!==""},O=u.every(s=>{const r=g[s.id];return Array.isArray(r)?r.length>0:r!=null&&r!==""});if(!h&&!S)return e.jsx(j,{user:b,role:"user",currentPath:"/user/quiz",children:e.jsxs("div",{className:"mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900",children:"Quiz & Challenges"}),e.jsx("p",{className:"mt-2 text-lg text-gray-600",children:"Test your knowledge on various health topics"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:K.map(s=>e.jsxs("button",{onClick:()=>q(s),className:`group relative overflow-hidden rounded-xl border-2 bg-white p-6 text-left shadow-sm transition-all duration-200 hover:scale-105 hover:shadow-lg ${s.color==="blue"?"border-blue-200 hover:border-blue-400 hover:bg-blue-50":s.color==="purple"?"border-purple-200 hover:border-purple-400 hover:bg-purple-50":s.color==="pink"?"border-pink-200 hover:border-pink-400 hover:bg-pink-50":s.color==="green"?"border-green-200 hover:border-green-400 hover:bg-green-50":s.color==="red"?"border-red-200 hover:border-red-400 hover:bg-red-50":s.color==="indigo"?"border-indigo-200 hover:border-indigo-400 hover:bg-indigo-50":s.color==="orange"?"border-orange-200 hover:border-orange-400 hover:bg-orange-50":s.color==="teal"?"border-teal-200 hover:border-teal-400 hover:bg-teal-50":"border-yellow-200 hover:border-yellow-400 hover:bg-yellow-50"}`,children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"text-4xl",children:s.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.name}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"10 questions"})]})]}),e.jsxs("div",{className:"mt-4 flex items-center text-sm font-medium text-gray-600 group-hover:text-gray-900",children:["Start Quiz",e.jsx("svg",{className:"ml-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]},s.id))})]})});if(S)return e.jsx(j,{user:b,role:"user",currentPath:"/user/quiz",children:e.jsx("div",{className:"mx-auto max-w-4xl px-4 py-6 sm:px-6 lg:px-8",children:e.jsx("div",{className:"rounded-lg bg-white p-12 shadow-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 h-16 w-16 animate-spin rounded-full border-4 border-gray-200 border-t-green-600"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Generating Quiz Questions"}),e.jsxs("p",{className:"mt-2 text-sm text-gray-500",children:["Creating personalized questions for ",h==null?void 0:h.name,"..."]})]})})})});if($&&u.length===0)return e.jsx(j,{user:b,role:"user",currentPath:"/user/quiz",children:e.jsx("div",{className:"mx-auto max-w-4xl px-4 py-6 sm:px-6 lg:px-8",children:e.jsx("div",{className:"rounded-lg bg-white p-8 shadow-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"mt-4 text-lg font-semibold text-gray-900",children:"Error Generating Quiz"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:$}),e.jsxs("div",{className:"mt-6 flex justify-center gap-4",children:[e.jsx("button",{onClick:C,className:"rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Choose Different Category"}),e.jsx("button",{onClick:()=>q(h),className:"rounded-md bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700",children:"Try Again"})]})]})})})});if(l)return e.jsx(j,{user:b,role:"user",currentPath:"/user/quiz",children:e.jsx("div",{className:"mx-auto max-w-4xl px-4 py-6 sm:px-6 lg:px-8",children:e.jsx("div",{className:"rounded-lg bg-white p-8 shadow-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`mx-auto mb-6 flex h-32 w-32 items-center justify-center rounded-full text-5xl font-bold ${l.passed?"bg-green-100 text-green-600":"bg-red-100 text-red-600"}`,children:[l.score,"%"]}),e.jsx("h1",{className:`mb-4 text-3xl font-bold ${l.passed?"text-green-600":"text-red-600"}`,children:l.passed?"üéâ Congratulations!":"Keep Learning!"}),e.jsxs("p",{className:"mb-2 text-lg text-gray-700",children:["You scored ",e.jsxs("span",{className:"font-semibold",children:[l.score,"%"]})]}),e.jsxs("p",{className:"mb-4 text-gray-600",children:[l.correctCount," out of ",l.totalQuestions," questions correct"]}),e.jsxs("div",{className:"mb-6 flex justify-center gap-6 text-sm text-gray-500",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Time:"})," ",l.timeElapsed]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Points:"})," ",l.earnedPoints,"/",l.totalPoints]})]}),l.passed?e.jsx("div",{className:"mb-6 rounded-lg bg-green-50 p-4",children:e.jsx("p",{className:"text-green-800",children:"‚úÖ Great job! You passed the quiz!"})}):e.jsx("div",{className:"mb-6 rounded-lg bg-amber-50 p-4",children:e.jsx("p",{className:"text-amber-800",children:"You need at least 70% to pass. Review the answers below and try again!"})}),e.jsxs("div",{className:"mt-8 border-t border-gray-200 pt-6",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-gray-900",children:"Review Your Answers"}),e.jsx("div",{className:"space-y-4 text-left",children:l.results.map((s,r)=>e.jsxs("div",{className:`rounded-lg border-2 p-4 ${s.isCorrect?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:[e.jsxs("div",{className:"mb-2 flex items-start justify-between",children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["Q",r+1,": ",s.question]}),s.isCorrect?e.jsx("span",{className:"ml-2 rounded-full bg-green-100 px-2 py-1 text-xs font-medium text-green-800",children:"‚úì Correct"}):e.jsx("span",{className:"ml-2 rounded-full bg-red-100 px-2 py-1 text-xs font-medium text-red-800",children:"‚úó Incorrect"})]}),e.jsxs("div",{className:"mt-2 space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Your answer:"})," ",e.jsx("span",{className:s.isCorrect?"text-green-700":"text-red-700",children:Array.isArray(s.userAnswer)?s.userAnswer.join(", "):s.userAnswer||"No answer"})]}),!s.isCorrect&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Correct answer:"})," ",e.jsx("span",{className:"text-green-700",children:Array.isArray(s.correctAnswer)?s.correctAnswer.join(", "):s.correctAnswer})]}),s.explanation&&e.jsxs("p",{className:"mt-2 text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Explanation:"})," ",s.explanation]})]})]},r))})]}),e.jsxs("div",{className:"mt-8 flex justify-center gap-4",children:[e.jsx("button",{onClick:C,className:"rounded-md border border-gray-300 px-6 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"New Quiz"}),!l.passed&&e.jsx("button",{onClick:B,className:"rounded-md bg-green-600 px-6 py-2 text-sm font-medium text-white hover:bg-green-700",children:"Retry Quiz"})]})]})})})});if(i){const s=i.options&&i.options.length>0,r=i.type==="multiple_choice",o=g[i.id];return e.jsx(j,{user:b,role:"user",currentPath:"/user/quiz",children:e.jsxs("div",{className:"mx-auto max-w-4xl px-4 py-6 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("button",{onClick:C,className:"inline-flex items-center text-sm font-medium text-gray-600 hover:text-gray-900",children:"‚Üê Back to Categories"}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("span",{className:"font-medium",children:"Time:"})," ",T(_)]})]}),e.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:[h.name," Quiz"]}),e.jsx("span",{className:"rounded-full bg-green-100 px-3 py-1 text-sm font-medium text-green-800",children:h.icon})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:["Progress: ",I," / ",f," answered"]}),e.jsxs("span",{className:"text-gray-500",children:["Question ",d+1," of ",f]})]}),e.jsx("div",{className:"h-3 w-full overflow-hidden rounded-full bg-gray-200",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-green-600 transition-all duration-300",style:{width:`${I/f*100}%`}})})]})]})]}),e.jsxs("form",{onSubmit:n=>{n.preventDefault(),H()},className:"rounded-lg bg-white p-6 shadow",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"block text-lg font-semibold text-gray-900",children:["Question ",d+1,": ",i.question]}),s?e.jsx("div",{className:"space-y-2",children:i.options.map((n,t)=>{const x=`${i.id}_${t}`,a=r?Array.isArray(o)&&o.includes(n):o===n;return e.jsxs("label",{className:`flex cursor-pointer items-center gap-3 rounded-lg border p-4 transition-all ${a?"border-green-500 bg-green-50 shadow-sm":"border-gray-200 bg-white hover:border-gray-300 hover:bg-gray-50"}`,children:[e.jsx("input",{type:r?"checkbox":"radio",name:r?`quiz_${i.id}[]`:`quiz_${i.id}`,className:"h-5 w-5 border-gray-300 text-green-600 focus:ring-2 focus:ring-green-500 focus:ring-offset-2",checked:a,onChange:()=>L(i.id,n,r)}),e.jsx("span",{className:"flex-1 text-sm text-gray-700",children:n})]},x)})}):e.jsx("input",{type:"text",name:`answer_${i.id}`,value:o||"",onChange:n=>L(i.id,n.target.value,!1),className:"w-full rounded-md border border-gray-300 px-4 py-2 focus:ring-2 focus:ring-green-500 focus:outline-none",placeholder:"Your answer",autoComplete:"off"})]}),e.jsxs("div",{className:"mt-8 flex items-center justify-between border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:C,className:"rounded-md border border-gray-300 px-6 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Cancel"}),d>0&&e.jsx("button",{type:"button",onClick:G,className:"rounded-md border border-gray-300 px-6 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"‚Üê Previous"})]}),e.jsx("div",{className:"flex gap-3",children:d<f-1?e.jsx("button",{type:"button",onClick:D,disabled:!M(),className:"rounded-md bg-green-600 px-6 py-2 text-sm font-medium text-white hover:bg-green-700 disabled:cursor-not-allowed disabled:opacity-50",children:"Next ‚Üí"}):e.jsx("button",{type:"submit",disabled:!O||E,className:"rounded-md bg-green-600 px-6 py-2 text-sm font-medium text-white hover:bg-green-700 disabled:cursor-not-allowed disabled:opacity-50",children:E?"Submitting...":"Submit Quiz"})})]}),!M()&&d<f-1&&e.jsx("p",{className:"mt-2 text-center text-sm text-amber-600",children:"Please answer this question to continue."})]}),e.jsx("div",{className:"mt-4 flex justify-center gap-2",children:u.map((n,t)=>{const x=(()=>{const c=g[n.id];return Array.isArray(c)?c.length>0:c!=null&&c!==""})(),a=t===d;return e.jsx("button",{type:"button",onClick:()=>p(t),className:`h-3 w-3 rounded-full transition-all ${a?"bg-green-600 ring-2 ring-green-500 ring-offset-2":x?"bg-green-400":"bg-gray-300"}`,title:`Question ${t+1}${x?" (Answered)":""}`},n.id)})})]})})}return null}export{X as default};
