import{r as b,j as e,$ as h,S as T}from"./app-DcA4OvQM.js";import{U as w}from"./UserLayout-CvYy6IBB.js";import"./user-BPb7GXe4.js";function O({user:N,module:d,lesson:x,category:E,quizResult:f,quizzes:L=[]}){const[u,v]=b.useState({}),[i,g]=b.useState(0),[$,A]=b.useState(!1),[n,k]=b.useState(f||null),m=L;b.useEffect(()=>{f&&k(f)},[f]);const a=m[i],c=m.length,C=Object.keys(u).filter(s=>{const t=u[s];return Array.isArray(t)?t.length>0:t!=null&&t!==""}).length,Q=(s,t,r)=>{v(o=>{let l;if(r){const p=o[s]||[];l=p.includes(t)?p.filter(M=>M!==t):[...p,t]}else l=t;const B={...o,[s]:l};return!r&&i<c-1&&setTimeout(()=>{g(p=>Math.min(p+1,c-1))},500),B})},_=()=>{i<c-1?g(i+1):z()},P=()=>{i>0&&g(i-1)},z=()=>{A(!0);const s=(m||[]).map(r=>{const o=u[r.id];return o!=null&&o!==""?{quiz_id:r.id,answer:o}:{quiz_id:r.id,answer:""}}),t=m.map(r=>({id:r.id,question:r.question,type:r.type,options:r.options,correct_answer:r.correct_answer,correct_answers:r.correct_answers}));T.post(`/user/learn/module/${d.id}/lesson/${x.id}/complete`,{answers:s,quizzes:t},{preserveScroll:!0,onFinish:()=>{A(!1)}})},S=()=>{if(!a)return!1;const s=u[a.id];return Array.isArray(s)?s.length>0:s!=null&&s!==""},q=m.every(s=>{const t=u[s.id];return Array.isArray(t)?t.length>0:t!=null&&t!==""});if(n)return e.jsx(w,{user:N,role:"user",currentPath:"/user/learn",children:e.jsx("div",{className:"mx-auto max-w-4xl",children:e.jsx("div",{className:"rounded-lg bg-white p-8 shadow",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`mx-auto mb-6 flex h-32 w-32 items-center justify-center rounded-full text-5xl font-bold ${n.passed?"bg-green-100 text-green-600":"bg-red-100 text-red-600"}`,children:[n.score,"%"]}),e.jsx("h1",{className:`mb-4 text-3xl font-bold ${n.passed?"text-green-600":"text-red-600"}`,children:n.passed?"üéâ Congratulations!":"Keep Trying!"}),e.jsxs("p",{className:"mb-2 text-lg text-gray-700",children:["You scored ",e.jsxs("span",{className:"font-semibold",children:[n.score,"%"]})]}),e.jsxs("p",{className:"mb-6 text-gray-600",children:["Correct Answers: ",e.jsx("span",{className:"font-semibold",children:n.correctAnswers})," out of"," ",e.jsx("span",{className:"font-semibold",children:n.totalQuestions})," questions"]}),n.passed?e.jsx("div",{className:"mb-6 rounded-lg bg-green-50 p-4",children:e.jsx("p",{className:"text-green-800",children:"‚úÖ You passed the quiz! Your score has been saved."})}):e.jsx("div",{className:"mb-6 rounded-lg bg-amber-50 p-4",children:e.jsxs("p",{className:"text-amber-800",children:["You need at least ",n.passMark,"% to pass. Your score has been saved. Try again to improve!"]})}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(h,{href:`/user/learn/module/${d.id}/lesson/${x.id}`,className:"rounded-md border border-gray-300 px-6 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Back to Lesson"}),!n.passed&&e.jsx("button",{onClick:()=>{k(null),v({}),g(0)},className:"rounded-md bg-green-600 px-6 py-2 text-sm font-medium text-white hover:bg-green-700",children:"Retry Quiz"}),n.passed&&n.nextLesson&&e.jsx(h,{href:`/user/learn/module/${d.id}/lesson/${n.nextLesson.id}`,className:"rounded-md bg-blue-600 px-6 py-2 text-sm font-medium text-white hover:bg-blue-700",children:"Next Lesson ‚Üí"}),e.jsx(h,{href:`/user/learn/module/${d.id}`,className:"rounded-md bg-green-600 px-6 py-2 text-sm font-medium text-white hover:bg-green-700",children:n.passed&&n.nextLesson?"Back to Module":"Continue Learning"})]})]})})})});if(!a||m.length===0)return e.jsx(w,{user:N,role:"user",currentPath:"/user/learn",children:e.jsx("div",{className:"mx-auto max-w-4xl",children:e.jsx("div",{className:"rounded-lg bg-white p-6 shadow",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"No Quiz Questions Available"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"There are no quiz questions available for this lesson at the moment. Please try refreshing the page or contact support if the issue persists."}),e.jsxs("div",{className:"mt-6 flex justify-center gap-4",children:[e.jsx(h,{href:`/user/learn/module/${d.id}/lesson/${x.id}`,className:"rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Back to Lesson"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"rounded-md bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700",children:"Refresh Page"})]})]})})})});const Y=a.options&&a.options.length>0,y=a.type==="multiple_choice",j=u[a.id];return e.jsx(w,{user:N,role:"user",currentPath:"/user/learn",children:e.jsxs("div",{className:"mx-auto max-w-4xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(h,{href:`/user/learn/module/${d.id}/lesson/${x.id}`,className:"mb-4 inline-flex items-center text-sm font-medium text-gray-600 hover:text-gray-900",children:"‚Üê Back to Lesson"}),e.jsxs("div",{className:"mt-4 rounded-lg bg-white p-6 shadow",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Lesson Quiz"}),e.jsx("p",{className:"mt-2 text-gray-600",children:e.jsx("span",{className:"font-medium",children:x.title})}),e.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:["Module: ",d.title]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:["Progress: ",C," / ",c," answered"]}),e.jsxs("span",{className:"text-gray-500",children:["Question ",i+1," of ",c]})]}),e.jsx("div",{className:"h-2 w-full overflow-hidden rounded-full bg-gray-200",children:e.jsx("div",{className:"h-full bg-green-600 transition-all duration-300",style:{width:`${C/c*100}%`}})})]})]})]}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),z()},className:"rounded-lg bg-white p-6 shadow",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"block text-lg font-semibold text-gray-900",children:["Question ",i+1,": ",a.question]}),Y?e.jsx("div",{className:"space-y-2",children:a.options.map((s,t)=>{const r=`${a.id}_${t}`,o=y?Array.isArray(j)&&j.includes(s):j===s;return e.jsxs("label",{className:`flex cursor-pointer items-center gap-3 rounded-lg border p-4 transition-all ${o?"border-green-500 bg-green-50 shadow-sm":"border-gray-200 bg-white hover:border-gray-300 hover:bg-gray-50"}`,children:[e.jsx("input",{type:y?"checkbox":"radio",name:y?`quiz_${a.id}[]`:`quiz_${a.id}`,className:"h-5 w-5 border-gray-300 text-green-600 focus:ring-2 focus:ring-green-500 focus:ring-offset-2",checked:o,onChange:()=>Q(a.id,s,y)}),e.jsx("span",{className:"flex-1 text-sm text-gray-700",children:s})]},r)})}):e.jsx("input",{type:"text",name:`answer_${a.id}`,value:j||"",onChange:s=>Q(a.id,s.target.value,!1),className:"w-full rounded-md border border-gray-300 px-4 py-2 focus:ring-2 focus:ring-green-500 focus:outline-none",placeholder:"Your answer",autoComplete:"off"})]}),e.jsxs("div",{className:"mt-8 flex items-center justify-between border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx(h,{href:`/user/learn/module/${d.id}/lesson/${x.id}`,className:"rounded-md border border-gray-300 px-6 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Cancel"}),i>0&&e.jsx("button",{type:"button",onClick:P,className:"rounded-md border border-gray-300 px-6 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"‚Üê Previous"})]}),e.jsx("div",{className:"flex gap-3",children:i<c-1?e.jsx("button",{type:"button",onClick:_,disabled:!S(),className:"rounded-md bg-green-600 px-6 py-2 text-sm font-medium text-white hover:bg-green-700 disabled:cursor-not-allowed disabled:opacity-50",children:"Next ‚Üí"}):e.jsx("button",{type:"submit",disabled:!q||$,className:"rounded-md bg-green-600 px-6 py-2 text-sm font-medium text-white hover:bg-green-700 disabled:cursor-not-allowed disabled:opacity-50",children:$?"Submitting...":"Submit Quiz"})})]}),!S()&&i<c-1&&e.jsx("p",{className:"mt-2 text-center text-sm text-amber-600",children:"Please answer this question to continue."})]}),e.jsx("div",{className:"mt-4 flex justify-center gap-2",children:m.map((s,t)=>{const r=(()=>{const l=u[s.id];return Array.isArray(l)?l.length>0:l!=null&&l!==""})(),o=t===i;return e.jsx("button",{type:"button",onClick:()=>g(t),className:`h-3 w-3 rounded-full transition-all ${o?"bg-green-600 ring-2 ring-green-500 ring-offset-2":r?"bg-green-400":"bg-gray-300"}`,title:`Question ${t+1}${r?" (Answered)":""}`},s.id)})})]})})}export{O as default};
