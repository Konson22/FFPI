import{r as u,m as F,j as e,L as O}from"./app-DcA4OvQM.js";import{A as R}from"./AdminLayout-B2rIqxXb.js";import{g as M}from"./gemini-BOoYf4TD.js";function B({lessons:p,user:w,currentPath:N}){var j;const[l,_]=u.useState(null),[o,c]=u.useState([]),[x,h]=u.useState(!1),[b,d]=u.useState(null),{data:P,setData:i,post:Q,processing:g,errors:f}=F({lesson_id:"",quizzes:[]}),C=t=>t.map(s=>{const a={single_choice:"multiple_choice",multiple_choice:"multiple_choice",true_false:"true_false",multiple_select:"multiple_select",short_answer:"short_answer"}[s.type]||"multiple_choice";let n=[];if(a==="true_false")n=[{text:"True",is_correct:s.correct_answer==="True"||s.correct_answer===!0},{text:"False",is_correct:s.correct_answer==="False"||s.correct_answer===!1}];else if(Array.isArray(s.options))if(typeof s.options[0]=="string"){const E=Array.isArray(s.correct_answers)?s.correct_answers:s.correct_answer?[s.correct_answer]:[];n=s.options.map(v=>({text:v,is_correct:E.includes(v)}))}else n=s.options;return{question:s.question,type:a,options:n,explanation:s.explanation||"",points:s.points||1}}),z=t=>{const s=p.find(r=>r.id===parseInt(t));_(s),i("lesson_id",t),c([]),d(null)},k=async()=>{if(!l){d("Please select a lesson first");return}h(!0),d(null);try{const t=l.content_markdown?l.content_markdown.replace(/```[\s\S]*?```/g," ").replace(/`([^`]+)`/g,"$1").replace(/!\[([^\]]*)\]\([^)]*\)/g,"$1").replace(/\[([^\]]+)\]\([^)]*\)/g,"$1").replace(/[*_>#~-]/g,"").replace(/\s{2,}/g," ").trim():"",s=await M(l.title,t,15),r=C(s);c(r),i("quizzes",r)}catch(t){console.error("Error generating quizzes:",t),d(t.isRateLimit?t.message:"Failed to generate quiz questions. Please try again.")}finally{h(!1)}},m=(t,s,r)=>{const a=[...o];a[t][s]=r,c(a),i("quizzes",a)},y=(t,s,r,a)=>{const n=[...o];n[t].options[s][r]=a,c(n),i("quizzes",n)},S=t=>{const s=[...o];s[t].options.push({text:"",is_correct:!1}),c(s),i("quizzes",s)},A=(t,s)=>{const r=[...o];r[t].options.length>1&&(r[t].options.splice(s,1),c(r),i("quizzes",r))},G=t=>{const s=o.filter((r,a)=>a!==t);c(s),i("quizzes",s)},L=t=>{if(t.preventDefault(),o.length===0){d("Please generate quiz questions first");return}Q("/admin/lessons/quizzes")};return e.jsxs(R,{user:w,currentPath:N,children:[e.jsx(O,{title:"Create Quiz Questions"}),e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsx("div",{className:"mx-auto max-w-6xl px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"rounded-lg bg-white p-6 shadow-md",children:[e.jsx("h1",{className:"mb-6 text-3xl font-bold text-gray-900",children:"Create Quiz Questions"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"lesson",className:"mb-2 block text-sm font-medium text-gray-700",children:"Select Lesson"}),e.jsxs("select",{id:"lesson",value:(l==null?void 0:l.id)||"",onChange:t=>z(t.target.value),className:"w-full rounded-md border border-gray-300 px-4 py-2 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Choose a lesson..."}),p.map(t=>e.jsxs("option",{value:t.id,children:[t.module_title," - ",t.title]},t.id))]})]}),l&&e.jsxs("div",{className:"mb-6 rounded-md bg-gray-50 p-4",children:[e.jsx("h3",{className:"mb-2 font-semibold text-gray-900",children:"Lesson Content Preview:"}),e.jsxs("pre",{className:"max-h-40 overflow-y-auto text-sm whitespace-pre-wrap text-gray-700",children:[((j=l.content_markdown)==null?void 0:j.substring(0,500))||"No content available",l.content_markdown&&l.content_markdown.length>500?"â€¦":""]})]}),l&&e.jsx("div",{className:"mb-6",children:e.jsx("button",{type:"button",onClick:k,disabled:x,className:"flex items-center gap-2 rounded-md bg-blue-600 px-6 py-3 text-white hover:bg-blue-700 disabled:cursor-not-allowed disabled:bg-gray-400",children:x?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"h-5 w-5 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Generating 15 questions..."]}):"Generate 15 Quiz Questions with AI"})}),b&&e.jsx("div",{className:"mb-4 rounded-md border border-red-200 bg-red-50 p-4",children:e.jsx("p",{className:"text-red-800",children:b})}),o.length>0&&e.jsxs("form",{onSubmit:L,className:"space-y-6",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Generated Quiz Questions (",o.length,")"]}),e.jsx("button",{type:"submit",disabled:g,className:"rounded-md bg-green-600 px-6 py-2 text-white hover:bg-green-700 disabled:bg-gray-400",children:g?"Saving...":"Save All Questions"})]}),o.map((t,s)=>e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-gray-50 p-6",children:[e.jsxs("div",{className:"mb-4 flex items-start justify-between",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Question ",s+1]}),e.jsx("button",{type:"button",onClick:()=>G(s),className:"text-red-600 hover:text-red-800",children:"Remove"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Question"}),e.jsx("textarea",{value:t.question,onChange:r=>m(s,"question",r.target.value),className:"w-full rounded-md border border-gray-300 px-4 py-2 focus:border-blue-500 focus:ring-blue-500",rows:"2"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Type"}),e.jsxs("select",{value:t.type,onChange:r=>m(s,"type",r.target.value),className:"w-full rounded-md border border-gray-300 px-4 py-2 focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"multiple_choice",children:"Multiple Choice"}),e.jsx("option",{value:"true_false",children:"True/False"}),e.jsx("option",{value:"multiple_select",children:"Multiple Select"}),e.jsx("option",{value:"short_answer",children:"Short Answer"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Options"}),t.options.map((r,a)=>e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx("input",{type:"text",value:r.text,onChange:n=>y(s,a,"text",n.target.value),className:"flex-1 rounded-md border border-gray-300 px-4 py-2 focus:border-blue-500 focus:ring-blue-500",placeholder:"Option text"}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:r.is_correct,onChange:n=>y(s,a,"is_correct",n.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Correct"})]}),t.options.length>1&&e.jsx("button",{type:"button",onClick:()=>A(s,a),className:"text-red-600 hover:text-red-800",children:"Remove"})]},a)),t.type!=="true_false"&&e.jsx("button",{type:"button",onClick:()=>S(s),className:"text-sm text-blue-600 hover:text-blue-800",children:"+ Add Option"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Explanation"}),e.jsx("textarea",{value:t.explanation||"",onChange:r=>m(s,"explanation",r.target.value),className:"w-full rounded-md border border-gray-300 px-4 py-2 focus:border-blue-500 focus:ring-blue-500",rows:"2",placeholder:"Explanation for the correct answer"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Points"}),e.jsx("input",{type:"number",value:t.points,onChange:r=>m(s,"points",parseInt(r.target.value)||1),min:"1",className:"w-32 rounded-md border border-gray-300 px-4 py-2 focus:border-blue-500 focus:ring-blue-500"})]})]},s)),f.quizzes&&e.jsx("div",{className:"text-sm text-red-600",children:f.quizzes})]})]})})})]})}export{B as default};
